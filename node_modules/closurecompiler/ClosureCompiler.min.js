/*
 ClosureCompiler.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 Released under the Apache License, Version 2.0
 see: https://github.com/dcodeIO/ClosureCompiler.js for details
*/
(function(){function d(b){this.options="object"==typeof b?b:{}}if("undefined"!=typeof window&&window.window||"function"!=typeof require)throw Error("ClosureCompiler.js can only be used within node.js");var n=require("path"),h=require("fs"),r=require("child_process");h.existsSync||(h.existsSync=n.existsSync);d.b=function(b,d,m){if(0>m.indexOf(d))throw"Illegal "+b+" value: "+d+" ("+m+" expected)";};d.JAVA_EXT="win32"==process.platform?".exe":"";d.getGlobalJava=function(){var b=null;process.env.JAVA_HOME&&
(b=n.join(process.env.JAVA_HOME,"bin","java"+d.JAVA_EXT),h.existsSync(b)||(b=null));b||(b="java");return b};d.getBundledJava=function(){return n.normalize(n.join(__dirname,"jre","bin","java"+d.JAVA_EXT))};d.testJava=function(b,d){r.exec('"'+b+'" -version',{},function(b,h,c){c+="";0<=c.indexOf('version "1.7.')?d(!0,null):0<=c.indexOf('version "')?d(!1,Error("Not Java 7")):d(!1,b)})};d.compile=function(b,h,m){(new d(h)).compile(b,m)};d.prototype.compile=function(b,p){function m(a,b){require("child_process").exec(a,
{c:20971520},b)}function q(a,b){m('"'+a+'" '+b,function(a,b,c){0<b.length||0<c.length?p(c+"",b+""):p(a,null)})}for(var c={},g=Object.keys(this.options),a=0;a<g.length;a++)c[g[a].toLowerCase()]=this.options[g[a]];delete c.js;delete c.js_output_file;var k='-client -jar "'+__dirname+'/compiler/compiler.jar"';b instanceof Array||(b=[b]);for(a=0;a<b.length;a++){if("string"!=typeof b[a]||0<=b[a].indexOf('"'))throw Error("Illegal source file: "+b[a]);e=h.statSync(b[a]);if(!e.isFile())throw Error("Source file not found: "+
b[a]);k+=' --js "'+b[a]+'"'}c.a||(c.a=[]);c.a instanceof Array||(c.a=[c.a]);for(var g=[],e,a=0;a<c.a.length;a++){if("string"!=typeof c.a[a]||""==c.a[a])throw Error("Externs directive does not point to a file or directory: "+c.a[a]);"node"==c.a[a].toLowerCase()&&(c.a[a]=__dirname+"/node_modules/closurecompiler-externs");e=h.statSync(c.a[a]);if(e.isDirectory()){var l=h.readdirSync(c.a[a]);for(e=0;e<l.length;e++){var f=c.a[a]+"/"+l[e];h.statSync(f).isFile()&&".js"==n.extname(f).toLowerCase()&&g.push(f)}}else if(e.isFile())g.push(c.a[a]);
else throw Error("Externs file not found: "+c.a[a]);}delete c.externs;for(a=0;a<g.length;a++)k+=' --externs "'+g[a]+'"';g=Object.keys(c);for(a=0;a<g.length;a++){l=g[a];f=c[g[a]];if(!/[a-zA-Z0-9_]+/.test(l))throw Error("Illegal option: "+l);if(!0===f)k+=" --"+l;else if(!1!==f)for(f instanceof Array||(f=[f]),e=0;e<f.length;e++){if(!/[^\s]*/.test(f[e]))throw Error("Illegal value for option "+l+": "+f[e]);k+=" --"+l+" "+f[e]}}d.testJava(d.getGlobalJava(),function(a){a?q(d.getGlobalJava(),k):d.testJava(d.getBundledJava(),
function(a){if(a)q(d.getBundledJava(),k);else throw Error("Java is not available, neither the bundled nor a global one.");})})};d.prototype.toString=function(){return"ClosureCompiler"};module.exports=d})(this);
